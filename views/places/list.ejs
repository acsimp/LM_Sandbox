<% include ../partials/header %>

<div class="container">

 <h1 class="my-5 text-center" style="width:100%">Add a New Place</h1>


    <div class="row" style="border-bottom: 2px solid lightgray;">

    <div id= "query_card" class="col-lg-3 col-md-4 col-sm-6">
            <div class="card mb-4 box-shadow text-white bg-dark">
                <div class="content card-body" style="border-top: 5px solid black;">
                    <h4 class="text-uppercase text-info">Find a match for:</h4>
                    <h5 id="query_card_name" class="card-title mb-3">
                    </h5>
                    <p id="query_card_formattedAddress" class="card-text"></p>
                </div>
            </div>
        </div>
                <div id= "no_match" class="col-lg-3 col-md-4 col-sm-6">
                <div class="content card-body">
                    <h5 id="" class="card-title mb-3">
                        No match found?
                    </h5>
                    <a href="/a-places/a-new" <%= searchQuery %>" class="btn btn-primary" onclick="clearFbSession()">Proceed without</a>
                </div>
            </div>

        </div>
      <div id="results" class="row">
    <h4 class="my-5 text-center" style="width:100%">Facebook Search Results</h4>
    
    <% if (place.data.length == 0) { %>
        <p>No search results found</p>
    <% } else { %>
        <% var i; %>
        <%for (i = 0; i < place.data.length; i++) { %>



        <!--<div class="col-md-4 col-sm-6">-->
        <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="content card mb-4 box-shadow">

                <% if (place.data[i].photos) { %>
                    <img class="card-img-top" src="<%=place.data[i].photos.data[0].images[0].source %>">
                <% } else { %>
                <% if (place.data[i].picture.data.url) { %>
                    <img class="card-img-top" src="<%=place.data[i].picture.data.url %>">
                <% } else { %>
                    <img class="card-img-top" src="https://uploads-ssl.webflow.com/57e5747bd0ac813956df4e96/5aebae14c6d254621d81f826_placeholder.png">
                <% } } %>
                <div class="content card-body">
                    <h5 class="card-title mb-3">
                        <%= place.data[i].name %>
                    </h5>
                    <% if (place.data[i].location) { %>
                        <b>
                            <%= place.data[i].location.street %><br />
                            <%= place.data[i].location.city %><br />
                            <%= place.data[i].location.zip %><br />
                            <%= place.data[i].location.country %><br />
                        </b>
                    <% } %>
                    <br/>
                     <% if (place.data[i].category_list) { %>
                            <%= place.data[i].category_list[0].name %><br />
                    <% } %>
                    
                    <br/>
                    <% if (place.data[i].link) { %>
                        <a href="<%= place.data[i].link %>" target="_blank">Facebook Page</a>
                    <br/>
                    <% } %>
                    <% if (place.data[i].website) { %>
                        <a href="<%= place.data[i].website %>" target="_blank">Website</a>
                        <br/>
                    <% } %>
                    <br />
                    <% if (place.data[i].overall_star_rating) { %>
                        <%= place.data[i].overall_star_rating + " out of 5 (" + place.data[i].rating_count + " reviews)"%><br />
                    <% } %>                    
                    <% if (place.data[i].engagement.count) { %>
                        <%= place.data[i].engagement.social_sentence %><br />
                    <% } %>
                    <% if (place.data[i].checkins) { %>
                        <%= place.data[i].checkins %> Check-ins<br />
                    <% } %>

                    <br />


                    <a class="mdc-fab" style="position: absolute; bottom: 1rem; right: 1rem; z-index: 1;" onclick="storePlace(<%= place.data[i].id %>)" href="/a-places/a-new"><span class="material-icons mdc-fab__icon" style="color: white">add</span></a>

                </div>
            </div>
        </div>

        <% } %>
        <% } %>

        <br />
        <!--<a href="<%= //place.paging.next %>"> next </a>-->

    </div>
</div>

<script>

var placeData = JSON.parse(sessionStorage.getItem('placeData'));
$(document).ready(function() {
              $('#query_card_name').text(placeData.name);
              $('#query_card_formattedAddress').text(placeData.formattedAddress);
            });

    function storePlace(id) {
        var fbPlaceID = id;
        //fetch object

        sessionStorage.setItem('fbPlaceID', fbPlaceID);

        console.log(sessionStorage.getItem(fbPlaceID));
    };
    
    function clearFbSession() {
        //fetch object
                sessionStorage.removeItem('fbPlaceID');
    };
    
</script>